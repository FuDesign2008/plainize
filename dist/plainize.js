!function(a){"use strict";var b=a.define,c="plainize/plainize.js",d="plainize",e={},f=function(a){return"[object Function]"===Object.prototype.toString.call(a)},g=function(a){var b=e[a];if(!b)throw new Error("Module "+a+" is not defined.");return b.inited===!1&&h(a),b.ret},h=function(b){var c,d={},h=e[b],i=h.factory;f(i)?(c=i.apply(a,[g,d,void 0]),h.ret=void 0===c?d:c):h.ret=i,h.inited=!0},i=function(a,b,d){if(e[a])throw new Error("Module "+a+" has been defined already.");f(b)&&(d=b),e[a]={factory:d,inited:!1},a===c&&h(a)};i("core/console",function(){var a,b=this,c=function(){},d={DEBUG:!1,EXPORTS:b.JTK_EXPORTS||{},log:c,warn:c,error:c};if(b.DEBUG!==!0)return d;if(!b.console||!b.console.log)return d;a=b.console,d.DEBUG=!0;try{d.log=a.log.bind(a),d.warn=a.warn.bind(a),d.error=a.error.bind(a)}catch(e){d.log=function(){var b,c=[],d=arguments.length;for(b=0;d>b;b++)c.push(String(arguments[b]));a.log(c.join(";"))},d.warn=function(a,b){var c=this;if(b=b?"["+b+"]":"",c.log(b+"WARN: "+a+"."),"object"==typeof a)throw a},d.error=function(a,b){var c=this;if(b=b?"["+b+"]":"",c.log(b+"ERROR: "+a+"!"),"object"==typeof a)throw a}}return d}),i("core/str/pad",function(a){var b=a("core/str/times");return function(a,c,d,e,f){a=null==a?"":String(a);var g=0,h=f?f(a):a.length;switch(d?d.length>1&&(d=d.charAt(0)):d=" ",e){case"right":return g=c-h,a+b(d,g);case"both":return g=c-h,b(d,Math.ceil(g/2))+a+b(d,Math.floor(g/2));default:return g=c-h,b(d,g)+a}}}),i("core/str/startsWith",function(){return function(a,b){return""===b?!0:null==a||null==b?!1:0===String(a).indexOf(String(b))}}),i("core/str/times",function(){return function(a,b){return null==a||""===a||isNaN(b)?"":1>b?"":new Array(b+1).join(String(a))}}),i("core/str/trim",function(){return function(a){return null==a||""===a?"":String(a).replace(/^[\s\t\xA0\u3000]+/,"").replace(/[\s\t\xA0\u3000]+$/,"")}}),i("core/underscore",function(a){var b=a("core/console"),c=this._||this.underscore;return c?(b.EXPORTS.underscore===!1&&c.noConflict&&(c=c.noConflict()),c):void b.error("no underscore library","underscore.js")}),i("plainize/formatter",function(a){var b=a("core/console"),c=a("core/underscore"),d=a("core/str/times"),e=a("core/str/trim"),f=a("core/str/startsWith"),g=a("web/dom/isTag"),h=a("core/str/pad"),i=function(a,c,f,g){b.log("orderList level: "+g._level);var h=" "+(a+1)+". ",i=e(f(c,g)||""),j=d(" ",4*g._level)+h,k=d(" ",j.length);return i=i.replace(/\n/g,"\n"+k),j+i+"\n"},j=function(a,c,g,h){b.log("unorderList level: "+h._level);var i=a+1+"",j=e(g(c,h)||""),k=d(" ",4*h._level)+" - ",l=d(" ",k.length);return f(j,i)&&(j=j.substr(i.length)),j?(j=j.replace(/\n/g,"\n"+l),k+j+"\n"):""};return{heading:function(a,b,c){var d=b(a,c)||"";return d?"\n\n"+d.toUpperCase()+"\n\n":""},paragraph:function(a,b,c){var d=b(a,c)||"";return d+"\n"},lineBreak:function(){return"\n"},horizontalLine:function(a,b,c){var e=d("-",c.wordwrap);return"\n\n"+e+"\n\n"},image:function(a){var b=e(a.getAttribute("src")),c=e(a.getAttribute("alt")||a.getAttribute("title")||"");return/^[#\/\.]/.test(b)||c===b||(c+="["+b+"]"),c},anchor:function(a,b,c){var d=b(a,c)||"",g=e(a.getAttribute("href")),h="mailto:";return/^([#\/\.]|javascript)/.test(g)||g===e(d)||(f(g,h)&&(g=e(g.substring(h.length))),d+="["+g+"]"),d},orderList:function(a,d,e){var f=this,h="",j=e._level;return c.each(a.children,function(a,b){g(a,"li")?h+=i(b,a,d,e):g(a,"ul")?(e._level++,h+=f.unorderList(a,d,e),e._level--):g(a,"ol")&&(e._level++,h+=f.orderList(a,d,e),e._level--)}),0===j&&h&&(h="\n"+h),b.log(h),h},unorderList:function(a,b,d){var e=this,f="",h=d._level;return c.each(a.children,function(a,c){g(a,"li")?f+=j(c,a,b,d):g(a,"ul")?(d._level++,f+=e.unorderList(a,b,d),d._level--):g(a,"ol")&&(d._level++,f+=e.orderList(a,b,d),d._level--)}),0===h&&f&&(f="\n"+f),f},table:function(a,d,f){var i="\n",j={caption:"",headRows:[],bodyRows:[],footRows:[]},k=0,l=function(a){var b,c,d=a.length,e=0;for(b=0;d>b;b++)c=a.charCodeAt(b),256>c?e++:e+=1;return e},m=function(a){var b=0;return c.each(a,function(a){a.length>b&&(b=l(a))}),b},n=[],o=function(a,d,f){var h=[],i=1;if(g(a,"tr"))return b.log(a),c.each(a.childNodes,function(a){if(g(a,"td")||g(a,"th")){var c,j,k,l=d(a,f),o=e(l);o?(b.log("tdText: --->",l),l=l.replace(/(\r?\n){2}/g,"\n"),l=l.replace(/(\r?\n){3,}/g,"\n\n"),l=l.split(/\r?\n/),b.log(l),c=h.length,j=n[c]||0,k=m(l),n[c]=k>j?k:j,l.length>i&&(i=l.length),h.push(l)):h.push([""])}}),k<h.length&&(k=h.length),h._maxLines=i,b.log("the row data"),b.log(h),h},p=function(a,d){var e,f,g=a._maxLines||1,i=[],j=function(a,b){f+=h(a[e]||"",n[b]+2," ","right",l)};for(b.log(a),e=0;g>e;e++)f="",c.each(a,j),b.log("oneLine: "+f),i.push(f);return i=i.join("\n")+"\n",d&&(i=i.toUpperCase()),i};return c.each(a.childNodes,function(a){g(a,"tbody")?(b.log("the tbody"),b.log(a),c.each(a.childNodes,function(a){var b=o(a,d,f);b&&j.bodyRows.push(b)})):g(a,"thead")?c.each(a.childNodes,function(a){var b=o(a,d,f);b&&j.headRows.push(b)}):g(a,"tfoot")?c.each(a.childNodes,function(a){var b=o(a,d,f);b&&j.footRows.push(b)}):g(a,"caption")?j.caption=d(a,f)+"\n":g(a,"tr")&&j.bodyRows.push(o(a,d,f))}),i+=j.caption,b.log(j),c.each(["head","body","foot"],function(a){var d=a+"Rows",e=j[d];e&&e.length&&(b.log("rows...",e),c.each(e,function(a){i+=p(a)}))}),i="\n\n"+i+"\n\n"},text:function(a){var b=e(a.nodeValue||"");return b&&(b+=" "),b}}}),i("web/dom/isTag",function(){return function(a,b){return b=String(b).toLowerCase(),a&&a.nodeName&&b?String(a.nodeName).toLowerCase()===b:!1}}),i("web/dom/nodeType",function(a){var b=a("core/underscore");return{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,getType:function(a){return a&&a.nodeType?a.nodeType:void 0},isNode:function(a){var c=this,d=c.getType(a);return b.isNumber(d)&&d>=c.ELEMENT_NODE&&d<=c.NOTATION_NODE},isElement:function(a){return this.getType(a)===this.ELEMENT_NODE},isAttribute:function(a){return this.getType(a)===this.ATTRIBUTE_NODE},isText:function(a){return this.getType(a)===this.TEXT_NODE},isCDataSection:function(a){return this.getType(a)===this.CDATA_SECTION_NODE},isEntityReference:function(a){return this.getType(a)===this.ENTITY_REFERENCE_NODE},isEntity:function(a){return this.getType(a)===this.ENTITY_NODE},isProcessingInstruction:function(a){return this.getType(a)===this.PROCESSING_INSTRUCTION_NODE},isComment:function(a){return this.getType(a)===this.COMMENT_NODE},isDocument:function(a){return this.getType(a)===this.DOCUMENT_NODE},isDocumentType:function(a){return this.getType(a)===this.DOCUMENT_TYPE_NODE},isDocumentFragment:function(a){return this.getType(a)===this.DOCUMENT_TYPE_NODE},isNotation:function(a){return this.getType(a)===this.NOTATION_NODE}}}),i("web/dom/parseHTML",function(){var a=function(a,b){var c,d,e;if(b.implementation&&b.implementation.createHTMLDocument)return c=b.implementation.createHTMLDocument("title"),c.body.innerHTML=a,c;if(e=b.defaultView||window,e.DOMParser){d=new e.DOMParser;try{c=d.parseFromString("","text/html")}catch(f){}if(c)return c.body.innerHTML=a,c}};return function(b,c,d){if(b){c=c||document;var e,f,g,h,i=a(b,c);if(i){if(d!==!1)return i.body;for(g=i.body.childNodes,e=g.length,h=[],f=0;e>f;f++)h.push(g[f]);return h}}}}),i("plainize/plainize",function(a){var b,c=a("core/console"),d=a("core/underscore"),e=a("web/dom/nodeType"),f=a("web/dom/parseHTML"),g=a("core/str/trim"),h=a("plainize/formatter"),i=["address","article","aside","audio","blockquote","canvas","dd","div","dl","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","noscript","ol","output","p","pre","section","table","tfoot","ul","video"],j=function(a,b){var f,k="",l=function(a,b){var c=a.childNodes,e=c.length,f="";return e>0&&d.each(c,function(a){f+=j(a,b)||""}),f};if(e.isElement(a)){if(f=a.tagName.toLowerCase(),b.skipElements[f])return"";switch(f){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":k+=h.heading(a,l,b);break;case"p":k+=h.paragraph(a,l,b);break;case"hr":k+=h.horizontalLine(a,l,b);break;case"br":k+=h.lineBreak(a,l,b);break;case"img":k+=h.image(a,l,b);break;case"a":k+=h.anchor(a,l,b);break;case"ol":k+=h.orderList(a,l,b);break;case"ul":k+=h.unorderList(a,l,b);break;case"table":k+=h.table(a,l,b);break;default:k+=l(a,b),g(k)&&(c.log(f),k=d.include(i,f)?"\n"+k+"\n":k)}}else e.isText(a)&&(k=h.text(a));return k};return b=function(a,b){var h,i;return e.isNode(a)?h=a:(h=f(a,document,!0),h||(h=document.createElement("div"),h.innerHTML=a)),h?(c.log(h),b=d.defaults({maxLength:0,wordwrap:80,skipElements:{script:!0,noscript:!0,style:!0}},b),b._level=0,i=j(h,b),i=i.replace(/(\r?\n){2}/g,"\n"),i=i.replace(/(\r?\n){3,}/g,"\n\n"),g(i)):void c.warn("No wrapper!")}}),a[d]=g(c),"function"==typeof b&&b.amd&&b(d,[],function(){return g(c)})}(this);